<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/layout}">

<section layout:fragment="content">

  <form name="reqForm"
      th:action="@{/settings/users/update}"
      class="fw-bold"
      th:object="${user}">

    <div class="container">
      <div class="row">
        <!-- audit area -->
        <div th:replace="common/components :: auditArea"></div>
      </div>

      <div class="row mb-3">
        <label class="form-label" for="id">ID *</label>
        <div class="input-group w-50">
          <input id="id" class="form-control" name="id" th:value="${id}"
                 readonly="readonly"/>
        </div>
      </div>

      <div class="row mb-3">
        <label class="form-label" for="email">Email *</label>
        <div class="input-group w-50">
          <input id="email" type="email" class="form-control" name="email"/>
          <div class="invalid-feedback fw-bold">
            에러 메세지
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <label class="form-label" for="roleIds">권한 *</label>
        <div class="input-group w-50">
          <select class="form-control" multiple name="roles">
            <option th:each="role : ${roles}" th:value="${role.id}"
                    th:text="${role.id}"></option>
          </select>
          <div class="invalid-feedback fw-bold">
            에러 메세지
          </div>
        </div>
      </div>

      <!-- 활성화 -->
      <div class="row mb-3">
        <label class="form-label" for="inlineRadio1">비활성화 여부 *</label>
        <div class="input-group w-50 fw-normal">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="accountDisabled"
                   id="inlineRadio1" value="true">
            <label class="form-check-label" for="inlineRadio1">비활성화</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="accountDisabled"
                   id="inlineRadio2" value="false">
            <label class="form-check-label" for="inlineRadio2">활성화</label>
          </div>
          <div class="invalid-feedback fw-bold">
            에러 메세지
          </div>
        </div>
      </div>

      <!-- 계정잠김 -->
      <div class="row mb-3">
        <label class="form-label" for="accountLocked1">계정잠김 여부 *</label>
        <div class="input-group w-50 fw-normal">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="accountLocked"
                   id="accountLocked1" value="true">
            <label class="form-check-label" for="accountLocked1">Locked</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="accountLocked"
                   id="accountLocked2" value="false">
            <label class="form-check-label" for="accountLocked2">Unlocked</label>
          </div>
          <div class="invalid-feedback fw-bold">
            에러 메세지
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <label class="form-label" for="loginFailCnt">로그인 실패 회수</label>
        <div class="input-group w-25">
          <input id="loginFailCnt" type="text" class="form-control" name="loginFailCnt"/>
          <div class="invalid-feedback fw-bold">
            에러 메세지
          </div>
        </div>
      </div>
    </div>
  </form>

  <div class="row">
    <div class="col">
      <button class="btn btn-outline-secondary" title="이전 화면으로 이동" onclick="goPrev();">
        <i class="bi bi-arrow-left"></i>
      </button>
      <button class="btn btn-outline-secondary" title="목록 화면으로 이동" onclick="gotoList();">
        <i class="bi bi-justify"></i>
      </button>
    </div>
    <div class="col">
      <button type="button" class="btn btn-primary float-end" onclick="goSave();">
        <i class="bi bi-save2"></i> 저장
      </button>
    </div>
  </div>
</section>

<section layout:fragment="script">
  <script>
    const getUser = () => {
      const f = document.reqForm;

      $.ajax({
        'method': 'GET',
        'url': '/api/settings/users/' + f.id.value,
        success(res){
          console.log(res);

          showAudit(res.id, res.createdBy, uiUtil.isoStrToReadable(res.createdAt)
              , res.updateBy, uiUtil.isoStrToReadable(res.updatedAt));

          f.email.value = res.email;
          f.roles.value = res.roles.map((el) => el.id);
          f.accountDisabled.value = res.accountDisabled;
          f.accountLocked.value = res.accountLocked;
          f.loginFailCnt.value = res.loginFailCnt;
        }
      });
    }

    // 상세정보 얻기
    getUser();
  </script>
</section>

</html>